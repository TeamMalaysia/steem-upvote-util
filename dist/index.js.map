{"version":3,"sources":["../src/index.js"],"names":["main","author","permlink","config","maximumPostAge","minimumLength","optimumLength","aboutPost","then","console","log","data","msg","created","isCheetah","articleLength","checkPostAge","createdTime","beautifyDate","weightage","weightageForPost","time","catch","Promise","resolve","reject","api","getContent","err","result","id","active_votes","filter","voter","length","bodyParse1","body","bodyParse2","upvote","steem_posting_key","steem_username","broadcast","vote","block_num","isoDate","unixDate","Date","replace","now","postLength","parseInt","fromNow"],"mappings":"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","file":"index.js","sourcesContent":["import steem from 'steem';\nimport moment from 'moment';\n\nimport 'babel-polyfill';\n\nimport {\n  imageParser,\n  linkParser,\n  divParser,\n  breakLineParser\n} from './regex';\n\nfunction main(author, permlink, config) {\n  const {\n    maximumPostAge,\n    minimumLength,\n    optimumLength\n  } = config;\n\n  return aboutPost(author, permlink)\n    .then(data => {\n      console.log(data);\n      if (data === 'POST_NOT_FOUND') {\n        return { msg: 'POST_NOT_FOUND' };\n      }\n\n      const {\n        author,\n        permlink,\n        created,\n        isCheetah,\n        articleLength\n      } = data;\n      if (isCheetah) {\n        return { msg: 'CHEETAH' };\n      } else if (checkPostAge(created, maximumPostAge)) {\n        // 3.5 days\n        return { msg: 'OLD_POST' };\n      } else {\n        let createdTime = beautifyDate(created);\n        let weightage = weightageForPost(\n          articleLength,\n          minimumLength,\n          optimumLength\n        );\n        return {\n          time: createdTime,\n          weightage,\n          author,\n          permlink,\n          msg: `The post is created ${createdTime} and will be upvoted by ${weightage /\n            100}%`\n        };\n      }\n    })\n    .catch(error => {\n      msg: 'POST_NOT_FOUND';\n    });\n}\n\n// ABOUT THE POST\n\nfunction aboutPost(author, permlink) {\n  return new Promise(function(resolve, reject) {\n    steem.api.getContent(author, permlink, function(\n      err,\n      result\n    ) {\n      if (\n        err ||\n        (result.id === 0 &&\n          result.author === '' &&\n          result.permlink === '')\n      ) {\n        reject('ERROR');\n      }\n\n      const isCheetah = !(\n        result.active_votes.filter(data => {\n          if (data.voter === 'cheetah') {\n            return true;\n          }\n          return false;\n        }).length === 0\n      );\n\n      const bodyParse1 = imageParser(result.body);\n      const bodyParse2 = linkParser(bodyParse1);\n      const articleLength = bodyParse2.length;\n\n      resolve({\n        author: result.author,\n        permlink,\n        created: result.created,\n        isCheetah,\n        articleLength\n      });\n    });\n  }).catch(err => 'POST_NOT_FOUND');\n}\n\n// UPVOTE\n\nfunction upvote(\n  steem_posting_key,\n  steem_username,\n  author,\n  permlink,\n  weightage\n) {\n  return steem.broadcast.vote(\n    steem_posting_key,\n    steem_username,\n    author,\n    permlink,\n    weightage,\n    function(err, result) {\n      if (err) {\n        return 'ERROR';\n      }\n\n      if (!!result.id && !!result.block_num) {\n        return result;\n      }\n      return 'ERROR';\n    }\n  );\n}\n\nfunction checkPostAge(isoDate, maximumPostAge) {\n  const unixDate = new Date(\n    isoDate\n      .replace(/-/g, '/')\n      .replace('T', ' ')\n      .replace('Z', '')\n  );\n  return Date.now() - unixDate > maximumPostAge;\n}\n\nfunction weightageForPost(\n  postLength,\n  minimumLength,\n  optimumLength\n) {\n  if (postLength < minimumLength) {\n    // 10% VP\n    return 10 * 100;\n  } else if (postLength < optimumLength) {\n    // 10% ~ 80% VP\n    return parseInt(\n      (postLength - minimumLength) /\n        (optimumLength - minimumLength) *\n        70 *\n        100 +\n        10\n    );\n  } else {\n    // 80% VP\n    return 80 * 100;\n  }\n}\n\nfunction beautifyDate(isoDate) {\n  const unixDate = new Date(\n    isoDate\n      .replace(/-/g, '/')\n      .replace('T', ' ')\n      .replace('Z', '')\n  );\n  return moment(unixDate).fromNow();\n}\n\nexport {\n  main,\n  aboutPost,\n  upvote,\n  checkPostAge,\n  weightageForPost,\n  beautifyDate\n};\n"]}